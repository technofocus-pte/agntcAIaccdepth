# 練習 2：建立與自訂 Prompt Flows

## 實驗概覽

在本實驗中，您將實際操作如何在 Azure AI Foundry 中初始化一個 Prompt Flow 專案，並設定必要的環境以開始開發、測試與優化 AI 應用程式。您將在 Azure AI Foundry 的 Prompt Flow 中建立並自訂 Prompt。從建立新流程開始，您將新增並設定 Prompt tool，並開發一個結合 LLM（大型語言模型）與 Prompt tools 的流程。透過撰寫並執行一個具有自訂輸入的範例流程，您將學會如何監控流程執行與評估輸出結果，進而理解開發、測試與優化 AI 驅動工作流程的實務步驟。

## 實驗目標

在本實驗中，您將執行以下任務：

- 任務 1：建立並自訂 Prompts
- 任務 2：使用 LLM 與 Prompt 工具開發流程

### 任務 1：建立並自訂 Prompts

建立與自訂 prompts 的過程包括設計具針對性與明確性的問題或陳述句，以引導出期望的回應或行動。此過程涵蓋定義清楚的目標、理解目標受眾，並使用精確的語言以確保 Prompt 的清晰度與相關性。透過自訂， Prompt 可以更貼近特定情境或使用者需求，進而提升互動的參與度與效果，廣泛應用於教育、客服與 AI 對話等場景。

1. 在瀏覽器中開啟一個新分頁，並使用以下連結前往 Azure AI Foundry 入口網站。

   ```
    https://ai.azure.com/
   ```

2. 點選左上角的 **Azure AI Foundry** 圖示。
3. 選擇您在先前實驗中建立的 AI Foundry 專案，例如 **ai-foundry-project-{suffix}** **(1)**。
4. 在左側導覽面板中，選擇 **提示流程** **(1)** ，然後點選 **+ 建立** **(2)** ，以將 Prompt 工具新增至您的流程中。

   ![](./media/prompt-flow.png)

5. 在  **建立新的流程** 面板中，於 **標準流程** 區塊下點選 **建立** **(1)**，然後輸入下方提供的資料夾名稱 **(2)**，接著點選 **建立** **(3)**：

   ```
   promptflow-{suffix}
   ```

   ![](./media/E2-T2-S7.png)

   > **注意**： 如果您遇到權限錯誤，請等待 5 分鐘後重新建立 Prompt Flow，並使用唯一的名稱（當系統顯示資料夾名稱已存在時）。流程建立完成後，請點選 **編輯** **(1)** 圖示，將其重新命名為 **promptflow-{suffix}** **(2)**，然後點選 **儲存** **(3)**。

   ![](./media/gpt-4-demo11.png)


### 任務 2：使用 LLM 與 Prompt 工具開發流程

使用大型語言模型（LLM）與 Prompt 工具開發流程，涉及設計一個結構化的互動方式，透過精心設計的 Prompt 來引導 LLM 產生預期的輸出。這個過程通常包括定義目標、選擇合適的 LLM，並根據模型回應反覆優化 Prompt，以確保其準確性與相關性。Prompt 工具協助管理與優化這些互動，使 LLM 在內容創作、資料分析與自動化客服等任務中更有效率與效能。

1. **提示流程**編輯頁面會開啟，您現在可以開始撰寫流程。預設會顯示一個範例流程，該流程包含 LLM 與 Python 工具的節點。

2. 您可以選擇性地新增更多工具至流程中。可見的工具選項包括 **LLM，Prompt，與 Python**。若要查看更多工具，請選擇 **+ 更多工具**。

   ![](./media/d4-2.png)

3. 在右邊的 **圖表** 面板，選取 **joke** **(1)**。在連線選項中，下拉選單中選擇現有的連線 **ai-odluser<inject key="DeploymentID" enableCopy="false"/>xxxxxxxx_aoai** **(2)** ，並在 LLM 工具編輯器中選擇部署項目 **gpt-4o** **(3)**。

   ![](./media/d5.png)

4. 向上捲動，在 **輸入**欄位中的 **topic** 輸入任意水果名稱，例如 **蘋果** **(1)**。

   ![](./media/apple-1.png)

5. 點選 **儲存** **(1)**，然後選擇 **開始計算工作階段** **(2)**。

   ![](./media/save-1.png)

   > **注意** 啟動運算階段可能需要 **10-15 分鐘** ，請耐心等待直到運算階段啟動完成。

6. 運算階段完成後，點選 **joke** 節點內的 **執行** 按鈕，以先執行 **joke node** 。接著將會執行 **echo** 節點。

   ![](./media/joke-03.png)

7. 當 **joke** 節點執行完畢後，從圖形中點選 **echo** **(1)** 節點，然後點選 **執行** **(2)** 按鈕。

   ![](./media/d6.png)

8. 當所有節點成功執行後，從提示流程的工具列中選擇 **執行**。

   ![](./media/run-1.png)

9. 提示流程執行完成後，選擇 **檢視完整輸出**，以檢視流程結果。輸出將類似於下方所示的畫面。

   ![](./media/image-30.png)

10. 您可以在 **輸出** 區段中查看流程執行狀態與輸出結果。

    ![](./media/image-31.png)

11. 從上方選單中選擇 **+ Prompt** **(1)** ，將 Prompt 工具新增至流程中，將流程命名為 **模型流程** **(2)**，然後選擇  **新增** **(3)**。

      ![](./media/gpt-4-demo17.png)
      ![](<./media/gpt-4-demo(15).png>)

12. 在 **模型流程** 的 **提示** **(1)** 區段中加入以下程式碼，然後選擇 **驗證和剖析輸入** **(2)**。

   ```jinja
   歡迎來到笑話機器人 !
   {% if user_name %}
    您好, {{ user_name }}!
   {% else %}
    您好!
   {% endif %}
   從下面的清單中，選擇一個類別，然後準備好笑吧:
   1. 🐶 動物笑話 – 從寵物到野生動物，這是一個充滿歡笑的動物園。
   2. 💼 辦公室幽默 – 適合朝九晚五的苦差事的笑話。
   3. 💻 技術與程式設計師笑話 – 用極客的咯咯笑聲來調節你的心情。
   4. 📚 學校與考試笑話 – 適合學生與倖存者的 A+ 喜劇。
   5. ⚡ 一句台詞 – 快速、詼諧、直擊笑點主題。
   6. 😏 諷刺笑話 – 冷冽、尖銳、帶著令人著迷的毒舌風味。
   ```

   ![](./media/gpt-4-demo16-1.png)

13. 在輸入區段中加入以下值，然後從提示流程的工具列中選擇 **儲存 (2)** 並點選 **執行 (3)**：

   - user_name: **約翰 (1)**

     ![](./media/gpt-4-demo14-1.png)

14. 若在執行過程中出現警告，如下圖所示，請點選 **無論如何也執行**。

      ![](./media/run-anway.png)

15. 流程執行完成後，選擇 **檢視完整輸出** 以檢視流程結果。輸出將類似於下方所示的畫面。

      ![](./media/output001.png)

16. 您可以在 **輸出** 區段中查看流程執行狀態與輸出結果。

      ![](./media/output1-2.png)

## 回顧

在本次實驗中，您已完成以下任務：

- 建立並自訂 Prompts
- 使用 LLM 與 Prompt 工具開發流程

### 恭喜！您已成功完成本次實驗課程！
### 請點選導覽連結，以繼續進行下一個實驗課程。
