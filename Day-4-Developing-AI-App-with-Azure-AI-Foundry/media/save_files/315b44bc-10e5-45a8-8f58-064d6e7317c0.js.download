(()=>{let e;let t="PubxFloorProvider";(Z=W||(W={})).WIN="WIN",Z.FLOORED="FLOORED",Z.NOBIDS="NOBIDS",(ee=X||(X={})).ERROR="ERROR",ee.WARNING="WARNING";let o=()=>(()=>({splitRate:95,samplingRate:1,enableInstrumentationLogs:false,pbNsKeys:"pbjs",pbNamespace:null,currency:"EUR",modelVersion:"cb_AB_z_dt_0.75_dwt_1.0_dnt_0.1",auctionDelay:100,pubxId:"315b44bc-10e5-45a8-8f58-064d6e7317c0",schema:['bidder','gptSlot','mediaType'],defaultValues:{'*|*|*':0.1704,'*|*|banner':0.1704,'*|/22152718,21740973315/imagetotext.info_bottom_adhesive|banner':0.1704,'*|/22152718,21740973315/imagetotext.info_middle_leaderboard|banner':0.1704,'kargo|*|banner':4,'ogury|*|banner':4,'gumgum|*|banner':4},floorFetchUrl:"https://floor.pbxai.com/?pubxId=315b44bc-10e5-45a8-8f58-064d6e7317c0&page="+window.location.href,floorMin:null,floorEnforcement:{"floorDeals":true},hbPbKey:"hb_pb",pubxSplitKey:"pubx-a",pubxSplitOnValue:"on",pubxSplitOffValue:"off",pubxOptimizedKey:"pubx-op",pubxOptimizedOnValue:"on",pubxOptimizedOffValue:"off",pubxABSplitAKey:"pubx-exp-A",pubxABSplitBKey:"pubx-exp-B",pubxMvKey:"pubx-m_v",pubxFloorKey:"pubx-floor",pubxFloorMvKey:"pubx-floor-mv",pubxExperiments:{}}))(),i=(e,t)=>{window[t]=window[t]||{},window[t].que=window[t].que||[],window[t].name=t,e.pbNamespace=window[t]},r=e=>({provider:"pubxai",options:{samplingRate:e.samplingRate,pubxId:e.pubxId}}),a=e=>{e.pbNamespace.que.push(function(){let{debug:t,error:o,remotePageError:i}=window.__pubx__.logger;if(!e.pbNamespace.installedModules.includes("pubxaiAnalyticsAdapter")){i({code:q.PUBX_AA_NOT_FOUND});return}{let o=r(e);e.pbNamespace.enableAnalytics(o),t("Enabling Analytics",o)}})},n=e=>({floorProvider:t,modelVersion:e.modelVersion,currency:e.currency,schema:{fields:e.schema},values:e.defaultValues}),d=e=>{var t;let o={floors:{auctionDelay:e.auctionDelay,endpoint:{url:e.floorFetchUrl},data:n(e)}};return e.floorMin&&(o.floors.floorMin=e.floorMin),e.floorEnforcement&&(o.floors.enforcement=e.floorEnforcement),S(e.pubxExperiments)&&(null===(t=window.__pubx__.abTestConfig)||void 0===t?void 0:t.isABTestEnabled)&&(o=x(o)),o},s=(e,o)=>{window.__pubxLoaded__&&e.pbNamespace.que.push(function(){let{debug:i,error:r,remotePageError:a}=window.__pubx__.logger;if(!e.pbNamespace.installedModules.includes("priceFloors")){a({code:q.PRICE_FLOORS_NOT_FOUND});return}let n=e.pbNamespace.getConfig("floors");n&&n.data&&n.data.floorProvider&&n.data.floorProvider!==t&&a({code:q.NON_PUBX_FLOORS_FOUND,payload:{existingFloors:n}});let d=o(e);window.__pubxFloorsConfig__=d,e.pbNamespace.setConfig(d),i("Setting Floors Config",d)})},l=(e,t)=>{let o=void 0!==e.adserverTargeting&&void 0!==e.adserverTargeting[t]&&!isNaN(e.adserverTargeting[t])&&parseFloat(e.adserverTargeting[t])>0;return o},u=(e,t)=>e.filter(e=>e.adUnitCode===t),_=(e,t)=>e.filter(e=>e.adUnitCode===t),c=(e,t)=>e.flatMap(e=>e.bids).filter(e=>e.adUnitCode===t),p=(e,t,o)=>0===e.length&&0===t.length?W.NOBIDS:e.some(e=>l(e,o))?W.WIN:W.FLOORED,g=(e,t,o,i,r,a)=>{try{if(void 0===e||"string"!=typeof t||"string"!=typeof o)throw Error(q.CURRENCY_INVALID_INPUT);if(void 0===i.pbNamespace.convertCurrency)throw Error(q.CURRENCY_MODULE_NOT_INSTALLED);if(t===o)return Number(e);return i.pbNamespace.convertCurrency(e,t,o)}catch(i){return a({code:q.CURRENCY_INVALID_INPUT,adUnitCode:r,payload:{error:i,value:e,fromCurrency:t,toCurrency:o}}),Number(e)}},f=(e,t)=>[...e,...t],b=e=>{if(void 0!==e)return{floorValue:e.floorValue,floorRule:e.floorRule,floorCurrency:e.floorCurrency}},m=(e,t,o,i,r,a,n)=>{var d;let{remoteAucError:s,remoteAucEvent:u}=n,{hbPbKey:_}=a,c,p,m,O,R={};switch(r){case W.WIN:let h=t.filter(e=>l(e,_)).sort((e,t)=>parseFloat(t.adserverTargeting[_])-parseFloat(e.adserverTargeting[_]))[0];c=parseFloat(h.adserverTargeting[_]),m=h.currency,O=h.floorData,R=h.adserverTargeting;break;case W.FLOORED:let E=f(o,t),v=E.sort((t,o)=>g(o.originalCpm,o.originalCurrency,a.currency,a,e.code,s)-g(t.originalCpm,t.originalCurrency,a.currency,a,e.code,s))[0];c=v.originalCpm,m=v.originalCurrency,O=v.floorData,R=v.adserverTargeting||{};break;case W.NOBIDS:let A;if(m=window.__pubxFloorsConfig__?window.__pubxFloorsConfig__.floors.data.currency:a.currency,e2(e)){c=.01;break}let N=B(e.code);if(A=N?eX(N,window.__nextfloorsConfig__)||eX(N,window.__pubxFloorsConfig__):eW(e.code,window.__nextfloorsConfig__)||eW(e.code,window.__pubxFloorsConfig__)){c=A;break}window.__pubx__.logger.debug("NOBID floor rule not found for adUnit",e.code);let I=i.map(e=>{var t;if("function"!=typeof e.getFloor)return;let o=null===(t=e.getFloor({size:"*",mediaType:"banner"}))||void 0===t?void 0:t.floor;return"number"==typeof o&&o>=0?o:void 0}).filter(e=>void 0!==e);if(I.length>0){c=I.reduce((e,t)=>e+t,0)/I.length;break}window.__pubx__.logger.debug("NOBID getFloor() not found for adUnit",e.code),void 0!==a.defaultValues["*|banner"]?c=a.defaultValues["*|banner"]:(window.__pubx__.logger.debug("NOBID TAG_DEFAULT_VALUES_NOT_FOUND for adUnit",e.code),c=.01)}return S(a.pubxExperiments)&&(null===(d=window.__pubx__.abTestConfig)||void 0===d?void 0:d.isABTestEnabled)&&Object.assign(R,to(a)),u({type:"pbBid",data:{adUnitCode:e.code,status:r,bidCurrency:m,bidValue:parseFloat(c.toFixed(4)),pubCurrency:a.currency,floorData:b(O),adserverTargeting:R}}),p=c,r===W.FLOORED&&(c=g(c,m,a.currency,a,e.code,s)),{bidCpmValue:parseFloat(c.toFixed(4)),originalBidCpmValue:parseFloat(p.toFixed(4)),bidCurrency:m,floorData:b(O),adserverTargeting:R}},O=(e,t,o,i)=>{var r,a,n,d;let{adUnitBidsReceived:s,adUnitBidsRejected:l,adUnitBidsFromBidderRequests:u}=w(e,t),_=t.auctionId,c=p(s,l,o.hbPbKey),g=null===(a=null===(r=u[0])||void 0===r?void 0:r.floorData)||void 0===a?void 0:a.floorProvider,f=null===(d=null===(n=u[0])||void 0===n?void 0:n.floorData)||void 0===d?void 0:d.modelVersion,b=e2(e),{bidCpmValue:O,originalBidCpmValue:R,bidCurrency:h,floorData:E,adserverTargeting:v}=m(e,s,l,u,c,o,i);return{auctionId:_,adUnit:e,adUnitStatus:c,bidCpmValue:O,originalBidCpmValue:R,bidCurrency:h,adserverTargeting:v,floorData:E,floorProvider:g,floorSkipStatus:b,floorModelVersion:f}},R=e=>e.adUnits.flatMap(e=>e.bids).map(e9).filter(e=>void 0!==e)[0],h=(e,t)=>{let o=e.bids.map(e9).filter(e=>void 0!==e)[0];if(void 0===o)throw t.remoteAucError({code:q.MODEL_VERSION_NOT_FOUND_READ,adUnitCode:e.code}),Error(e_[q.MODEL_VERSION_NOT_FOUND_READ].message+" for adUnit "+e.code);return o},E=e=>{let t=e.includes("_AB_")?e.split("_AB_")[1].split("_")[0]:void 0;return t},v=(e,t,o)=>{switch(o){case W.WIN:return e.includes("_dwt_")?parseFloat(e.split("_dwt_")[1].split("_")[0]):t.winBidMultiplier;case W.FLOORED:return e.includes("_dt_")?parseFloat(e.split("_dt_")[1].split("_")[0]):t.flooredBidMultiplier;case W.NOBIDS:return e.includes("_dnt_")?parseFloat(e.split("_dnt_")[1].split("_")[0]):t.noBidMultiplier}},A=(e,t,o)=>{if(e.includes("_fm_"))return parseFloat(e.split("_fm_")[1].split("_")[0]);if(!t.pmacFloorMultiplier)throw o({code:q.PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG}),Error(e_[q.PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG].message);return t.pmacFloorMultiplier},N=(e,t,o)=>{let i=void 0!==e.mediaTypes.banner,r=e.bids.some(e=>!!e.bidder),a=e4(e);if(!t&&a)throw o({code:q.PUBX_OFF_FLOORS_FOUND,adUnitCode:e.code}),Error(e_[q.PUBX_OFF_FLOORS_FOUND].message+" for adUnitCode "+e.code);return i&&r&&(!t&&!a||t&&a)},I=e=>e?e.filter(e=>!!e.originalCpm):[],y=(e,t,o,i)=>{let{remoteAucError:r}=i,{bidCpmValue:a,adUnitStatus:n,adUnit:d,auctionId:s}=e;ec({remoteError:r,code:q.UNCAUGHT_ERROR,location:"triggerPmac"},()=>{e$(s,d.code,a,n,o,A(t,o,r),eF(t,o),i)}),d.code;let l=parseFloat((a*v(t,o,n)).toFixed(4));return e2(d)?void 0:{adUnitCode:d.code,floorValue:l,status:n}},w=(e,t)=>{let o=t.auctionId,i=u(t.bidsReceived,e.code),r=_(I(t.bidsRejected),e.code),a=c(t.bidderRequests,e.code);return{auctionId:o,adUnitBidsReceived:i,adUnitBidsRejected:r,adUnitBidsFromBidderRequests:a}},C=e=>e.type===X.ERROR&&e.arguments.length>0&&e.arguments[0].includes("Price Floors"),T=e=>{let t=e[0],o="";if(e.length>1)try{o=JSON.stringify(e[1])}catch(t){o=e[1]}window.__pubx__.logger.error("pubx: Price Floors Error",e),window.__pubx__.logger.remotePageError({code:q.FLOORS_RESPONSE_INVALID,payload:{error:t,message:o}})},U=e=>{e.pbNamespace.que.push(()=>{e.pbNamespace.onEvent("auctionInit",t=>{!function(e,t){var o,i,r,a;o=this,i=void 0,r=void 0,a=function*(){let{debug:o,error:i}=window.__pubx__.logger,r=100/e.samplingRate/100;if(100*Math.random()<r&&function(){let e=localStorage.getItem("lastCallDate"),t=new Date().toLocaleDateString();return e!==t}()){o("Telemetry Triggered");let r=function(e,t){let o=[],[i,r]=function(e){try{let t=e.adUnits||[],o=new Set,i=[];return t.forEach(function(e){let t;let r=Object.keys(e.mediaTypes||{});if(e.mediaTypes.banner){let o=e.mediaTypes.banner;t=o.sizes.map(e=>e.join("x"))}else t=[];let a=B(e.code),n=a?a.getAdUnitPath()===e.code?a.getSlotElementId():a.getSlotElementId()===e.code?a.getAdUnitPath():"":"";i.push({code:e.code,sizes:t,gamSlot:n,media_type:r}),e.bids.forEach(function(e){o.add(e.bidder)})}),[{adUnits:i,bidders:Array.from(o)},null]}catch(t){let e="Error in getAdUnitAndBidders, reason:"+t.message;return[{adUnits:[],bidders:[]},e]}}(t);null!==r&&o.push(r);let[a,n]=function(e){try{let t={PubxaiAA:!!e.pbNamespace.installedModules.includes("pubxaiAnalyticsAdapter"),PriceFloors:!!e.pbNamespace.installedModules.includes("priceFloors"),PubxaiRTD:!!e.pbNamespace.installedModules.includes("pubxaiRtdProvider")};return[t,null]}catch(t){let e="Error in getPubxModuleStatus, reason:"+t.message;return[{},e]}}(e);null!==n&&o.push(n);let d=eA();return{pubx_id:e.pubxId,pbjs_version:e.pbNamespace.version||"",installed_modules:e.pbNamespace.installedModules.filter(e=>!e.includes("BidAdapter"))||[],ad_units:i.adUnits,bidders:i.bidders,pubx_modules_status:a,errors:o.length>0?o:null,timestamp:new Date().toISOString(),page_info:eg(d)}}(e,t);try{let e=navigator.sendBeacon("https://analytics.pbxai.com/telemetry",new Blob([JSON.stringify(r)],{type:"application/json"}));e?(localStorage.setItem("lastCallDate",new Date().toLocaleDateString()),o("Telemetry data sent successfully using sendBeacon",r)):o("Telemetry API call failed using sendBeacon")}catch(e){i("Telemetry API call failed due to an error:",e)}}},new(r||(r=Promise))(function(e,t){function n(e){try{s(a.next(e))}catch(e){t(e)}}function d(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var o;t.done?e(t.value):((o=t.value)instanceof r?o:new r(function(e){e(o)})).then(n,d)}s((a=a.apply(o,i||[])).next())})}(e,t=Object.assign({},t))});let t=e.pbNamespace.getEvents().filter(e=>"auctionDebug"===e.eventType).map(e=>e.args).filter(C);t.forEach(e=>T(e.arguments)),e.pbNamespace.onEvent("auctionDebug",e=>{C(e)&&T(e.arguments)})})},x=e=>{var t,o,i,r;if(!(null===(t=window.__pubx__.abTestConfig)||void 0===t?void 0:t.isABTestEnabled)||(null===(o=window.__pubx__.abTestConfig)||void 0===o?void 0:o.testBucket)!=="A"&&(null===(i=window.__pubx__.abTestConfig)||void 0===i?void 0:i.testBucket)!=="B")return e;let a=(null===(r=window.__pubx__.abTestConfig)||void 0===r?void 0:r.testBucket)==="A";return e.floors.enforcement?e.floors.enforcement.enforceJS=a:e.floors.enforcement={enforceJS:a},e},S=e=>!!e&&"number"==typeof(null==e?void 0:e.enforceJsSplit)&&e.enforceJsSplit>0,D=()=>(()=>({flooredBidMultiplier:0.75,noBidMultiplier:0.1,winBidMultiplier:1.0,pmacFloorMultiplier:0.5,decayRate:null,gamBuckets:[{'pbx_a0d_n':[0,0.03]},{'pbx_a1d_n':[0.03,0.06]},{'pbx_a2d_n':[0.06,0.09]},{'pbx_a3d_n':[0.09,0.12]},{'pbx_a4d_n':[0.12,0.15]},{'pbx_b0d_n':[0.15,0.2]},{'pbx_b1d_n':[0.2,0.25]},{'pbx_b2d_n':[0.25,0.3]},{'pbx_b3d_n':[0.3,0.35]},{'pbx_b4d_n':[0.35,0.4]},{'pbx_b5d_n':[0.4,0.45]},{'pbx_b6d_n':[0.45,0.5]},{'pbx_b7d_n':[0.5,0.55]},{'pbx_b8d_n':[0.55,0.6]},{'pbx_b9d_n':[0.6,0.65]},{'pbx_b10d_n':[0.65,0.7]},{'pbx_b11d_n':[0.7,0.75]},{'pbx_b12d_n':[0.75,0.8]},{'pbx_b13d_n':[0.8,0.85]},{'pbx_b14d_n':[0.85,0.9]},{'pbx_b15d_n':[0.9,0.95]},{'pbx_b16d_n':[0.95,1]},{'pbx_c0d_n':[1,1.1]},{'pbx_c1d_n':[1.1,1.2]},{'pbx_c2d_n':[1.2,1.3]},{'pbx_c3d_n':[1.3,1.4]},{'pbx_c4d_n':[1.4,1.5]},{'pbx_c5d_n':[1.5,1.6]},{'pbx_c6d_n':[1.6,1.7]},{'pbx_c7d_n':[1.7,1.8]},{'pbx_c8d_n':[1.8,1.9]},{'pbx_c9d_n':[1.9,2]},{'pbx_d0d_n':[2,2.25]},{'pbx_d1d_n':[2.25,2.5]},{'pbx_d2d_n':[2.5,2.75]},{'pbx_d3d_n':[2.75,3]},{'pbx_d4d_n':[3,3.25]},{'pbx_d5d_n':[3.25,3.5]},{'pbx_d6d_n':[3.5,3.75]},{'pbx_d7d_n':[3.75,4]},{'pbx_d8d_n':[4,4.25]},{'pbx_d9d_n':[4.25,4.5]},{'pbx_d10d_n':[4.5,4.75]},{'pbx_d11d_n':[4.75,5]},{'pbx_d12d_n':[5,111111]}]}))(),F=()=>{window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[]},P=e=>{let t=o();i(t,e);let r=D();return F(),Object.assign(Object.assign({},t),r)},L=(e,t)=>{let{error:o}=window.__pubx__.logger,i=googletag.pubads().getSlots(),r=[];return e.forEach(e=>{let t=i.find(t=>t.getAdUnitPath()===e||t.getSlotElementId()===e);void 0!==t&&r.push({adUnitCode:e,slot:t})}),r},B=e=>{if(!(null==googletag?void 0:googletag.pubads)||"function"!=typeof googletag.pubads)return;let t=googletag.pubads().getSlots().find(t=>t.getAdUnitPath()===e||t.getSlotElementId()===e);return t},M=(e,t,o)=>{e.pbNamespace.que.push(()=>{e.pbNamespace.onEvent("auctionEnd",i=>{try{i=Object.assign({},i);let{makeRemoteAucError:r,makeRemoteAucEvent:a,error:n}=window.__pubx__.logger,d=r(i),s=a(i),l={remoteAucError:d,remoteAucEvent:s};ec({remoteError:d,code:q.UNCAUGHT_ERROR,location:"readAndSetKvsAuction"},()=>{let{variant:r}=window.__pubx__,a=r.includes("STATIC"),n="PB_GAM_CUSTOM_MG"===r;(n||a)&&(window.__pubx__.logger.debug("pubx: setPubxLoadedFromAuctionData",n,a),window.__pubxLoaded__=i.adUnits.some(e4),window.__pubx__.logger.debug("pubx: window.__pubxLoaded__",window.__pubxLoaded__));let s=window.__pubxLoaded__;o&&(i=o(i,e,l)),i.adUnits.filter(e=>N(e,s,l.remoteAucError)).map(o=>{ec({remoteError:d,code:q.UNCAUGHT_ERROR,location:"readAndSetKvsAdUnit"},()=>{var r;let a=tt(o,e,l);S(e.pubxExperiments)&&(null===(r=window.__pubx__.abTestConfig)||void 0===r?void 0:r.isABTestEnabled)&&Object.assign(a,to(e));let d=O(o,i,e,l);if(e4(o)){if(n){let t={vendor:"pubxai",auctionId:i.auctionId,transactionId:o.transactionId||eA(),billingId:eA(),type:"impression"};e.pbNamespace.rp.billableEvent(t),window.__pubx__.logger.debug("pubx: billable event raised for adUnit:",o.code,t)}let t=h(o,l);Object.assign(a,e6(t,e));let r=y(d,t,e,l);r&&Object.assign(a,e5(r,t,e,l.remoteAucError))}t&&t(o,i.auctionId,a,e,l)})})})}catch(e){window.__pubx__.logger.error(e)}})})},G=(e,t)=>{if(0===e)return t[0];let o=t.find(t=>{let o=Object.keys(t)[0],[i,r]=t[o];return e>i&&e<=r});return o},V=(e,t,o)=>{let i=G(e.floorValue,t.gamBuckets);if(void 0===i)throw o({code:q.GAM_BUCKET_NOT_FOUND,adUnitCode:e.adUnitCode,payload:{floorWithStatus:e}}),Error(e_[q.GAM_BUCKET_NOT_FOUND].message+" for "+JSON.stringify(e));let r=Object.keys(i)[0],a=e.status===W.WIN?"_w":e.status===W.FLOORED?"_f":"_n";return r.split("_n")[0]+a},k=e=>{e.pbNamespace.que.push(function(){let{error:e,remotePageError:t}=window.__pubx__.logger;googletag.cmd.push(()=>{googletag.pubads().addEventListener("slotAdded",e=>{ec({remoteError:t,code:q.UNCAUGHT_GAM_ERROR,location:"setupEventHandlersForGamQue"},()=>{let t=e.slot,{__pubxGamQue__:o}=window,i=o.filter(e=>t&&(t.getAdUnitPath()===e.adUnitCode||t.getSlotElementId()===e.adUnitCode));i.forEach(e=>{if(e.cmd()){let t=o.findIndex(t=>t.id===e.id);t>-1&&o.splice(t,1)}})})})})})};(et=K||(K={})).DBM_HEURISTICS="dbm_heuristics",et.PMAC_DATA="pmac_data";let j=()=>{try{let e=[localStorage,sessionStorage];e.forEach(e=>{e.removeItem("pbx:dpbid"),e.removeItem("pubx:pmac"),e.removeItem("pubx:extraData")})}catch(e){console.error(e)}};var W,X,K,H,q,Y,z,J,$,Q,Z,ee,et,eo,ei,er,ea,en,ed,es,el=function(e,t,o,i){return new(o||(o=Promise))(function(r,a){function n(e){try{s(i.next(e))}catch(e){a(e)}}function d(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(n,d)}s((i=i.apply(e,t||[])).next())})},eu=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)0>t.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(o[i[r]]=e[i[r]]);return o};(eo=H||(H={})).IN_PROGRESS="IN_PROGRESS",eo.SUCCESS="SUCCESS",eo.ERROR="ERROR",(ei=q||(q={})).GPT_SLOT_NOT_FOUND="GPT_SLOT_NOT_FOUND",ei.GAM_QUE_GPT_SLOT_NOT_FOUND="GAM_QUE_GPT_SLOT_NOT_FOUND",ei.GAM_BUCKET_NOT_FOUND="GAM_BUCKET_NOT_FOUND",ei.CALC_FLOOR_NOT_FOUND="CALC_FLOOR_NOT_FOUND",ei.IMPROVEMEDIA_API_NOT_FOUND="IMPROVEMEDIA_API_NOT_FOUND",ei.INVESTING_FILTER_NOT_FOUND="INVESTING_FILTER_NOT_FOUND",ei.PUBX_AA_NOT_FOUND="PUBX_AA_NOT_FOUND",ei.PRICE_FLOORS_NOT_FOUND="PRICE_FLOORS_NOT_FOUND",ei.NON_PUBX_FLOORS_FOUND="NON_PUBX_FLOORS_FOUND",ei.CURRENCY_INVALID_INPUT="CURRENCY_INVALID_INPUT",ei.CURRENCY_MODULE_NOT_INSTALLED="CURRENCY_MODULE_NOT_INSTALLED",ei.GET_FLOOR_NOT_FOUND="GET_FLOOR_NOT_FOUND",ei.NO_BID_FLOOR_RULE_NOT_FOUND="NO_BID_FLOOR_RULE_NOT_FOUND",ei.TAG_DEFAULT_VALUES_NOT_FOUND="TAG_DEFAULT_VALUES_NOT_FOUND",ei.PUBX_OFF_FLOORS_FOUND="PUBX_OFF_FLOORS_FOUND",ei.MODEL_VERSION_NOT_FOUND_READ="MODEL_VERSION_NOT_FOUND_READ",ei.PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG="PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG",ei.INVALID_SCHEMA_FIELDS_FLOORS_RESPONSE="INVALID_SCHEMA_FIELDS_FLOORS_RESPONSE",ei.MISSING_ADUNIT_FLOOR_RESPONSE="MISSING_ADUNIT_FLOOR_RESPONSE",ei.PMAC_FLOOR_RESPONSE_NOT_AVAILABLE="PMAC_FLOOR_RESPONSE_NOT_AVAILABLE",ei.UNCAUGHT_ERROR="UNCAUGHT_ERROR",ei.UNCAUGHT_GAM_ERROR="UNCAUGHT_GAM_ERROR",ei.PUBX_ANALYTICS_ERROR="PUBX_ANALYTICS_ERROR",ei.FLOORS_RESPONSE_INVALID="FLOORS_RESPONSE_INVALID",(er=Y||(Y={})).INFO="INFO",er.WARNING="WARNING",er.ERROR="ERROR",er.FATAL="FATAL";let e_={[q.GPT_SLOT_NOT_FOUND]:{message:"GPT Slot not found",severity:Y.WARNING},[q.GAM_QUE_GPT_SLOT_NOT_FOUND]:{message:"Gam Que: GPT Slot not found",severity:Y.ERROR},[q.GAM_BUCKET_NOT_FOUND]:{message:"GAM Bucket not found",severity:Y.WARNING},[q.CALC_FLOOR_NOT_FOUND]:{message:"floorWithStatus not found",severity:Y.FATAL},[q.IMPROVEMEDIA_API_NOT_FOUND]:{message:"lwhbim.adServerKeywordsAdUnit is not defined",severity:Y.ERROR},[q.INVESTING_FILTER_NOT_FOUND]:{message:"window._imhb_auctions is not defined",severity:Y.ERROR},[q.PUBX_AA_NOT_FOUND]:{message:"pubxaiAnalyticsAdapter module is not installed",severity:Y.WARNING},[q.PRICE_FLOORS_NOT_FOUND]:{message:"priceFloors module is not installed",severity:Y.WARNING},[q.NON_PUBX_FLOORS_FOUND]:{message:"Non-pubx floor provider present",severity:Y.WARNING},[q.CURRENCY_INVALID_INPUT]:{message:"Invalid input types for currency conversion",severity:Y.WARNING},[q.CURRENCY_MODULE_NOT_INSTALLED]:{message:"currency module of prebid.js is not installed",severity:Y.WARNING},[q.GET_FLOOR_NOT_FOUND]:{message:"calc nbids - None of bidderRequests.bids.getFloor() is defined",severity:Y.WARNING},[q.NO_BID_FLOOR_RULE_NOT_FOUND]:{message:"calc nbids - Floor rule not found in __pubxFloorsConfig__ and __nextfloorsConfig__",severity:Y.WARNING},[q.TAG_DEFAULT_VALUES_NOT_FOUND]:{message:"defaultValues of *|banner in config is undefined",severity:Y.ERROR},[q.PUBX_OFF_FLOORS_FOUND]:{message:"pubxLoaded is false but has floorData",severity:Y.FATAL},[q.MODEL_VERSION_NOT_FOUND_READ]:{message:"floorModelVersion is undefined but adUnit.bids is not",severity:Y.FATAL},[q.PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG]:{message:"PMAC floor multiplier not found in config",severity:Y.ERROR},[q.INVALID_SCHEMA_FIELDS_FLOORS_RESPONSE]:{message:"Invalid schema fields in floor rules response, expected only ['gptSlot']",severity:Y.ERROR},[q.MISSING_ADUNIT_FLOOR_RESPONSE]:{message:"adUnitCode not found in floor rules response",severity:Y.ERROR},[q.PMAC_FLOOR_RESPONSE_NOT_AVAILABLE]:{message:"Floors Reponse not available for pmac",severity:Y.WARNING},[q.UNCAUGHT_ERROR]:{message:"Uncaught Error",severity:Y.ERROR},[q.UNCAUGHT_GAM_ERROR]:{message:"Uncaught GAM Error",severity:Y.ERROR},[q.PUBX_ANALYTICS_ERROR]:{message:"Pubx Analytics Error",severity:Y.ERROR},[q.FLOORS_RESPONSE_INVALID]:{message:"Floors Response Invalid",severity:Y.ERROR}},ec=({remoteError:e,code:t,location:o},i)=>{try{i()}catch(i){window.__pubx__.logger.error(i),e({code:t,payload:{name:i.name,message:i.message,location:o}})}},ep=e=>{let{__pubx__:{variant:t,version:o}}=window;return{variant:t,version:o,loadTime:window.__loadTime__,pbVersion:e.pbNamespace.version,pbNamespace:e.pbNamespace.name}},eg=e=>({userAgent:navigator.userAgent,host:window.location.host,path:window.location.pathname,pageId:e,doNotTrack:navigator.doNotTrack}),ef=(e,t)=>e.pbNamespace.getEvents().filter(e=>"auctionEnd"===e.eventType).findIndex(e=>e.args.auctionId===t),eb=e=>e.pbNamespace.getEvents().filter(e=>"auctionInit"===e.eventType).length,em=e=>{let{code:t,adUnitCode:o,payload:i}=e,{message:r,severity:a}=e_[t];return{code:t,severity:a,message:r,adUnitCode:o,payload:i}},eO=(e,t,o,i)=>{let r=t;if(e.adUnitCode){let{adUnits:t,bidderRequests:o,bidsReceived:i,bidsRejected:a}=r;r=Object.assign(Object.assign({},r),{adUnits:t.filter(t=>t.code===e.adUnitCode),bidderRequests:o.map(t=>Object.assign(Object.assign({},t),{bids:t.bids.filter(t=>t.adUnitCode===e.adUnitCode)})),bidsReceived:i.filter(t=>t.adUnitCode===e.adUnitCode),bidsRejected:a?a.filter(t=>t.adUnitCode===e.adUnitCode):void 0})}let{auctionId:a,adUnits:n,bidderRequests:d,bidsReceived:s,bidsRejected:l}=r,u={adUnits:n.map(({code:e,sizes:t,bids:o,mediaTypes:i})=>({code:e,mediaTypes:Object.keys(i)})),bidderRequestsCount:d.length,bidsReceived:s.map(({adUnitCode:e,adserverTargeting:t,cpm:o,currency:i,originalCpm:r,originalCurrency:a,floorData:n})=>({adUnitCode:e,adserverTargeting:t?{hb_pb:t.hb_pb}:void 0,cpm:o,currency:i,originalCpm:r,originalCurrency:a,floorData:n?{floorValue:n.floorValue}:void 0})),bidsRejected:l?l.map(({adUnitCode:e,adserverTargeting:t,cpm:o,currency:i,originalCpm:r,originalCurrency:a,floorData:n})=>({adUnitCode:e,adserverTargeting:t?{hb_pb:t.hb_pb}:void 0,cpm:o,currency:i,originalCpm:r,originalCurrency:a,floorData:n?{floorValue:n.floorValue}:void 0})):void 0};return Object.assign({previousAuctionCount:ef(o,a),auctionId:a,auctionInfo:u,modelVersion:R(t)},eR(e,o,i))},eR=(e,t,o)=>({type:"error",isPubxEnabled:window.__pubxLoaded__,pubxId:t.pubxId,tagInfo:ep(t),pageInfo:eg(o),errorData:em(e),timesince:Date.now()-window.__loadTimestamp__,timestamp:Date.now()}),eh=e=>{let t=e.pbNamespace.getConfig("floors");return t&&t.data&&t.data.floorProvider?t.data.floorProvider:void 0},eE=(e,t,o,i)=>{let{auctionId:r,adUnits:a,bidsReceived:n,bidsRejected:d,bidderRequests:s}=e,l={adUnitCount:a.length,bidCount:n.length+(d?d.length:0),bidders:[...new Set(s.map(({bidderCode:e})=>e))]};return{type:"event",isPubxEnabled:window.__pubxLoaded__,pubxId:t.pubxId,loadedBeforePb:window.__loadedBeforePb__,tagInfo:ep(t),floorProvider:eh(t),pageInfo:eg(i),missedAuctionCount:o,timesince:Date.now()-window.__loadTimestamp__,timestamp:Date.now(),previousAuctionCount:ef(t,r),auctionId:r,auctionInfo:l,modelVersion:R(e),pbBidData:[],gamTargetingData:[]}},ev=e=>{let{severity:t}=e_[e.code];return!1},eA=()=>{let e=new Date().getTime(),t="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){let i=16*Math.random();return e>0?(i=(e+i)%16|0,e=Math.floor(e/16)):(i=(t+i)%16|0,t=Math.floor(t/16)),("x"===o?i:3&i|8).toString(16)})},eN=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),eI=()=>{window.__pubxGamQue__.filter(e=>!e.logged).forEach(e=>{e.error(),e.logged=!0})},ey=e=>{let t=[],o=[],i=[],r=eb(e),a=eA(),n=e.enableInstrumentationLogs&&1/e.samplingRate>Math.random();window.__pubxLogsEnabled__=n;let d=e=>JSON.stringify(e).length,s=(e,t)=>{let o=[],i=0,r=[];for(let a of e){let e=d([a]);i+e>t?(r.push(o),o=[a],i=e):(o.push(a),i+=e)}return o.length>0&&r.push(o),r},l=(e,t)=>{0!==e.length&&s(e,65536).map(e=>{JSON.parse(JSON.stringify(e));let o=new Blob([JSON.stringify(e)],{type:"application/json"});navigator.sendBeacon(t,o)})},u=()=>!!navigator.sendBeacon&&!!document.visibilityState;u()&&document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&(eI(),l([...t,...o,...i],"https://analytics.pbxai.com/logs"),[t,o,i].map(e=>e.splice(0)))});let _=window.location.search,c=new URLSearchParams(_),p=(...e)=>{e=e.filter(e=>void 0!==e),c.has("pubx_debug")&&console.error("%cPubx.ai","background-color: #fc6203; color: white; border-radius: 3px; padding: 1px 4px","ERROR:",...e)};return{debug:(e,...t)=>{c.has("pubx_debug")&&console.info("%cPubx.ai","background-color: #fc6203; color: white; border-radius: 3px; padding: 1px 4px","INFO:",e,...t)},error:p,makeRemoteAucError:o=>i=>{let{code:r,adUnitCode:d,payload:s}=i;p(e_[r].message,d,s),u()&&(n||ev(i))&&t.push(eO(i,o,e,a))},remotePageError:t=>{let{code:i,adUnitCode:r,payload:d}=t;p(e_[i].message,r,d),u()&&(n||ev(t))&&o.push(eR(t,e,a))},makeRemoteAucEvent:t=>{let o=(o,i)=>{let n=i.find(e=>e.auctionId===t.auctionId);if(void 0===n&&(n=eE(t,e,r,a),i.push(n)),"pbBid"===o.type)n.pbBidData.push(o.data);else if("gamTargeting"===o.type){let e=o.data,t=n.gamTargetingData.find(t=>t.adUnitCode===e.adUnitCode);void 0===t?n.gamTargetingData.push(e):Object.assign(t,e)}};return e=>{u()&&n&&o(e,i)}}}},ew=e=>{window.__pubx__.logger.debug("version:",window.__pubx__.variant+"_"+window.__pubx__.version+"_"+e.name)},eC=()=>{window.__loadTime__=window.__loadTimestamp__?Date.now()-window.__loadTimestamp__:-1,window.__loadTimestamp__=Date.now()},eT=(e,t)=>{let o=window.__pubxFloorsConfig__.floors,{auctionDelay:i,endpoint:r,data:a}=o,n=eu(o,["auctionDelay","endpoint","data"]);window.__nextfloorsConfig__={floors:Object.assign(Object.assign({},n),{data:e})}},eU=(e,t)=>{let o=t.pbNamespace.getConfig("floors"),{auctionDelay:i,endpoint:r,data:a}=o,n=eu(o,["auctionDelay","endpoint","data"]);window.__nextfloorsConfig__={floors:Object.assign(Object.assign({},n),{data:e})}},ex=e=>window.__pmacCpmHistory__[e],eS=e=>{let t=ex(e);return t?t.history:[]},eD=(e,t,o,i)=>{let{debug:r}=window.__pubx__.logger,{__pmacCpmHistory__:a}=window;void 0===a[t]&&(a[t]={history:[],decayRate:void 0});let n={auctionId:e,cpm:o,adUnitStatus:i};eS(t).push(n),r("Update Pmac history",t,n)},eF=(e,t)=>{let{debug:o}=window.__pubx__.logger;return e.includes("_dr_")?-1*parseFloat(e.split("_dr_")[1].split("_")[0]):null!==t.decayRate?-1*t.decayRate:(o("No decay rate in floor model version or config",e),null)},eP=(e,t,o)=>(e=0===e?.01:e)*Math.exp(t*o),eL=(e,t)=>{let{debug:o}=window.__pubx__.logger,i=ex(e);i.decayRate=t,o("Assigning decay rate",e,i.decayRate)},eB=e=>{let t=eS(e);return 0!==t.length},eM=(e,t)=>{let{remoteAucError:o}=t,{__pmacCpmHistory__:i}=window,r=Object.keys(i);if("PB_GAM_CUSTOM_AY"===window.__pubx__.variant)r.forEach(o=>{eB(o)&&eK(o,void 0,eH(o,e),t)});else{let i=L(r,o);i.forEach(({adUnitCode:o,slot:i})=>{eB(o)&&eK(o,i,eH(o,e),t)})}},eG=e=>"|banner"+(e.fields.includes("size")?"|*":""),eV=(e,t,o)=>{let i=Object.keys(t),r=eG(o),a=i.find(t=>[e.getAdUnitPath()+r,e.getSlotElementId()+r].includes(t));return a},ek=(e,t,o)=>{let i=Object.keys(t),r=i.find(t=>t.split(eG(o))[0]===e);return r},ej=(e,t,o)=>{let i=Object.keys(t),r=i.find(t=>t.split(eG(o))[0]===ta(e));return r},eW=(e,t)=>{if(t){let o=ek(e,t.floors.data.values,t.floors.data.schema);if(o)return t.floors.data.values[o]}},eX=(e,t)=>{if(t){let o=eV(e,t.floors.data.values,t.floors.data.schema);if(o)return t.floors.data.values[o]}},eK=(e,t,o,i)=>{let r;let{remoteAucError:a}=i,{__nextfloorsConfig__:n}=window;if(void 0===n)throw Error("__nextfloorsConfig__ undefined. Skip updating adUnit floors config");let{floors:{data:{values:d,schema:s}}}=n;if(void 0===(r="PB_GAM_CUSTOM_AY"===window.__pubx__.variant?ej(e,d,s):eV(t,d,s))){a({code:q.MISSING_ADUNIT_FLOOR_RESPONSE,adUnitCode:e});return}d[r]=o},eH=(e,t)=>{let{decayRate:o,history:i}=ex(e),[r,a]=[i[0].cpm,i.length],n=eP(r,o,a),d=n*t;return d<.01?.01:parseFloat(d.toFixed(4))},eq=(e,t)=>el(void 0,void 0,void 0,function*(){let{debug:t}=window.__pubx__.logger;try{let o=yield fetch(e.floorFetchUrl),i=yield o.json();t("PMAC Received floor rules",i),eT(i,e)}catch(i){let o=n(e);t("PMAC Default floor rules",o),eT(o,e)}}),eY=(e,t)=>el(void 0,void 0,void 0,function*(){let{debug:t}=window.__pubx__.logger;try{let o=yield fetch(e.floorFetchUrl),i=yield o.json();t("PMAC Received floor rules",i),eU(i,e)}catch(i){let o=n(e);t("PMAC Default floor rules",o),eU(o,e)}}),ez=(e,t)=>el(void 0,void 0,void 0,function*(){let{debug:t}=window.__pubx__.logger,o=e.pbNamespace.getConfig("floors");window.__nextfloorsConfig__={floors:o},t("Reading floors from config",o)}),eJ=()=>el(void 0,void 0,void 0,function*(){let e=()=>{let{debug:e}=window.__pubx__.logger,t=window.__pubxFloorsConfig__;if(!t)throw Error("__pubxFloorsConfig__ not defined. Skip pmac");window.__nextfloorsConfig__=t,e("Reading floors from rtd module",t)};e(),window.addEventListener("floorsApi",t=>{t.detail.status===H.SUCCESS&&e()})}),e$=(e=null,(t,o,i,r,a,n,d,l)=>el(void 0,void 0,void 0,function*(){let{remoteAucError:u}=l,{variant:_,isRtd:c}=window.__pubx__;if(null===d){window.__pubx__.logger.debug("pubx: PMAC Turned off");return}null===e&&(e=c?eJ():"PB_GAM_CUSTOM_AZ"===_?ez(a,l):"PB_GAM_CUSTOM_MG"==_||_.includes("STATIC")?eY(a,l):eq(a,l)),yield e,window.__pubx__.logger.debug("pubx:","triggering pmac"),eD(t,o,i,r),eL(o,d);let{__nextfloorsConfig__:p}=window;if(void 0===p)throw u({code:q.PMAC_FLOOR_RESPONSE_NOT_AVAILABLE,adUnitCode:o}),Error("__nextfloorsConfig__ undefined. Skip updating floors config");"PB_GAM_CUSTOM_AY"===_?(eM(n,l),s(a,e=>p)):googletag.cmd.push(()=>{ec({remoteError:u,code:q.UNCAUGHT_GAM_ERROR,location:"updateSetFloor"},()=>{eM(n,l),s(a,e=>p)})})})),eQ=()=>({debug:(e,...t)=>{},error:(...e)=>{},makeRemoteAucError:e=>e=>{},remotePageError:e=>{},makeRemoteAucEvent:e=>e=>{}}),eZ=(e,t)=>{j(),window.__pubxFloors__={},!1!==window.__loadedBeforePb__&&(window.__loadedBeforePb__=void 0===e.pbNamespace.version),window.__pmacCpmHistory__={},eC(),window.__pubx__={variant:t,version:"1744874877299",isRtd:!1},window.__pubx__.logger||(window.__pubx__.logger=eQ()),window.__pubxLoaded__&&S(e.pubxExperiments)&&ts(e.pubxExperiments.enforceJsSplit)&&(window.__pubx__.abTestConfig={isABTestEnabled:!0,testBucket:50>100*Math.random()?"A":"B"}),e.pbNamespace.que.push(function(){window.__pubx__.logger=ey(e),ew(e.pbNamespace)}),window.__pubxGamQue__=[]},e0=(e,t)=>{window.__pubxLoaded__=e1(e.splitRate),eZ(e,t)},e1=e=>(void 0===window.__pubxLoaded__&&(window.__pubxLoaded__=e>100*Math.random()),window.__pubxLoaded__),e2=e=>e.bids.some(({floorData:e})=>e&&e.floorProvider===t&&e.skipped),e9=e=>{let{floorData:o}=e;if(o&&o.floorProvider===t&&o.modelVersion)return o.modelVersion},e4=e=>e.bids.some(e9),e3=(e,t,o)=>{if("object"!=typeof e||0===t.length){window.__pubx__.logger.error("setObjectValueFromKeyPath: invalid arguments",{object:e,keyPath:t,value:o});return}let i=t.length-1;for(let o=0;o<i;++o){let i=t[o];i in e||(e[i]={}),e=e[i]}e[t[i]]=o},e6=(e,t)=>{let o={},i=E(e);return i&&(o[t.pubxMvKey]=i),o},e5=(e,t,o,i)=>{let r={},a=V(e,o,i);r[o.pubxFloorKey]=a;let n=E(t);if(n){let e=e7(a,n);r[o.pubxFloorMvKey]=e}return r},e7=(e,t)=>e+"-"+t,e8=(e,t)=>{let o=e2(e);return o?t.pubxOptimizedOffValue:t.pubxOptimizedOnValue},te=(e,t)=>{let o=e4(e);return o?t.pubxSplitOnValue:t.pubxSplitOffValue},tt=(e,t,o)=>{let i={},r=te(e,t);if(i[t.pubxSplitKey]=r,r===t.pubxSplitOnValue){let r=h(e,o),a=t.modelVersion===r;a||(i[t.pubxOptimizedKey]=e8(e,t))}return i},to=e=>{var t;let o={},i={enforceJSOn:"f_enf_on",enforceJSOff:"f_enf_off"},r=null===(t=window.__pubx__.abTestConfig)||void 0===t?void 0:t.testBucket,a="A"===r?e.pubxABSplitAKey:e.pubxABSplitBKey,n="A"===r?i.enforceJSOn:i.enforceJSOff;return o[a]=n,o},ti=(e,t,o,i,r)=>{let{remoteAucEvent:a}=r;e3(window.__pubxFloors__,[e,t,o],i),window.__pubx__.logger.debug("Setting KVs in Global",{auctionId:e,adUnitCode:t,key:o,value:i}),a({type:"gamTargeting",data:{adUnitCode:t,[o]:i}})},tr=(e,t,o,i,r)=>{Object.entries(o).forEach(([o,i])=>{ti(t,e.code,o,i,r)})},ta=e=>e.split("__ayManagerEnv__")[0],tn=(e,t)=>e.bidder,td=e=>{let t=d(e);return t.floors.additionalSchemaFields={bidder:tn},t},ts=e=>e>100*Math.random();var tl={};function tu(e){return e[0]+"x"+e[1]}function t_(e){return Array.isArray(e)&&2===e.length&&!isNaN(e[0])&&!isNaN(e[1])}tl=function(e,t,o,i,r){for(t=t.split?t.split("."):t,i=0;i<t.length;i++)e=e?e[t[i]]:r;return e===r?o:e};let tc=(e,t)=>e.getAdUnitPath()===t||e.getSlotElementId()===t;function tp(e){let t;if(window.googletag&&"function"==typeof window.googletag.pubads&&"function"==typeof window.googletag.pubads().getSlots){let o=window.googletag.pubads().getSlots();t=o.find(t=>tc(t,e))}return t}function tg(e){var t;let o=null===(t=window.__pubx__)||void 0===t?void 0:t.logger;try{let t=tp(e);if(t)return{gptSlot:t.getAdUnitPath(),divId:t.getSlotElementId()};return{}}catch(e){return null==o||o.error("getGptSlotInfoForAdUnitCode error:",e),null==o||o.remotePageError({code:q.UNCAUGHT_ERROR,payload:{name:e.name,message:e.message}}),{}}}(ea=z||(z={}))[ea.DESKTOP=0]="DESKTOP",ea[ea.MOBILE=1]="MOBILE",ea[ea.TABLET=2]="TABLET",(en=J||(J={}))[en.CHROME=0]="CHROME",en[en.FIREFOX=1]="FIREFOX",en[en.SAFARI=2]="SAFARI",en[en.EDGE=3]="EDGE",en[en.INTERNET_EXPLORER=4]="INTERNET_EXPLORER",en[en.OTHER=5]="OTHER",(ed=$||($={}))[ed.WINDOWS=0]="WINDOWS",ed[ed.MAC=1]="MAC",ed[ed.LINUX=2]="LINUX",ed[ed.UNIX=3]="UNIX",ed[ed.IOS=4]="IOS",ed[ed.ANDROID=5]="ANDROID",ed[ed.OTHER=6]="OTHER";let tf=()=>{try{if(/ipad|android 3.0|xoom|sch-i800|playbook|tablet|kindle/i.test(navigator.userAgent.toLowerCase()))return z.TABLET;if(/iphone|ipod|android|blackberry|opera|mini|windows\sce|palm|smartphone|iemobile/i.test(navigator.userAgent.toLowerCase()))return z.MOBILE;return z.DESKTOP}catch(e){return z.DESKTOP}},tb=()=>{try{if(/Edg/.test(navigator.userAgent))return J.EDGE;if(/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))return J.CHROME;if(navigator.userAgent.match("CriOS"))return J.CHROME;if(/Firefox/.test(navigator.userAgent))return J.FIREFOX;else if(/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor))return J.SAFARI;else if(/Trident/.test(navigator.userAgent)||/MSIE/.test(navigator.userAgent))return J.INTERNET_EXPLORER;else return J.OTHER}catch(e){return J.OTHER}},tm=()=>{try{if(-1!=navigator.userAgent.indexOf("Android"))return $.ANDROID;if(-1!=navigator.userAgent.indexOf("like Mac"))return $.IOS;if(-1!=navigator.userAgent.indexOf("Win"))return $.WINDOWS;if(-1!=navigator.userAgent.indexOf("Mac"))return $.MAC;if(-1!=navigator.userAgent.indexOf("Linux"))return $.LINUX;if(-1!=navigator.appVersion.indexOf("X11"))return $.UNIX;return $.OTHER}catch(e){return $.OTHER}};(es=Q||(Q={})).BID_TIMEOUT="bidTimeout",es.BID_RESPONSE="bidResponse",es.BID_REJECTED="bidRejected",es.AUCTION_END="auctionEnd",es.BID_WON="bidWon";let tO=[Q.BID_TIMEOUT,Q.BID_RESPONSE,Q.BID_REJECTED,Q.AUCTION_END,Q.BID_WON];class tR{constructor(e,t,o){var i;this.auctionCache={},this.auctionRankCounter=0,this.auctionIdMap=new Map,this.auctionRankMap=new Map,window.__pubx__=window.__pubx__||{},window.__pubx__.analytics={auctionCache:this.auctionCache,auctionIdMap:this.auctionIdMap},this.initOptions=Object.assign({samplingRate:1},e),this.config=o,this.prebidInstance=t,this.logger=null===(i=window.__pubx__)||void 0===i?void 0:i.logger}getWindowLocation(){var e;try{return(null===(e=window.top)||void 0===e?void 0:e.location)||window.location}catch(e){return this.logger.error("PubxAnalytics getWindowLocation error:",e),this.logger.remotePageError({code:q.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}}),window.location}}getAdServerDataForBid(e){try{let t=(null==e?void 0:e.adUnitCode)||"",o=tp(t);if(o)return Object.fromEntries(o.getTargetingKeys().filter(e=>e.startsWith("pubx-")||e.startsWith("hb_")&&1===(e.match(/_/g)||[]).length).map(e=>[e,o.getTargeting(e)]));return{}}catch(e){return this.logger.error("PubxAnalytics getAdServerDataForBid error:",e),this.logger.remotePageError({code:q.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}}),{}}}extractBid(e){var t;return{auctionId:this.getAuctionId(e.auctionId),adUnitCode:e.adUnitCode,gptSlotCode:tg(e.adUnitCode).gptSlot||null,bidderCode:e.bidder,cpm:e.cpm,originalCpm:e.originalCpm,originalCurrency:e.originalCurrency,creativeId:e.creativeId,dealId:e.dealId,currency:e.currency,floorData:e.floorData,mediaType:e.mediaType,netRevenue:e.netRevenue,requestTimestamp:e.requestTimestamp,responseTimestamp:e.responseTimestamp,status:e.status,sizes:(function(e){var t;let o=null===(t=window.__pubx__)||void 0===t?void 0:t.logger;try{return("string"==typeof e?e.split(/\s*,\s*/).map(e=>e.match(/^(\d+)x(\d+)$/i)).filter(e=>null!==e).map(([e,t,o])=>[parseInt(t,10),parseInt(o,10)]):Array.isArray(e)?t_(e)?e.filter(t_):[e]:[]).map(tu)}catch(e){return null==o||o.error("parseSizesInput error:",e),null==o||o.remotePageError({code:q.UNCAUGHT_ERROR,payload:{name:e.name,message:e.message}}),[]}})(e.size).toString(),statusMessage:e.statusMessage,timeToRespond:e.timeToRespond,transactionId:e.transactionId,bidId:e.bidId||e.requestId,placementId:e.params?((t=tl)&&t.__esModule?t.default:t)(e,"params.0.placementId"):null,source:e.source||"null"}}getAuctionId(e){try{if(!e)throw Error(`Missing auctionId(${e})provided to PubxAnalytics in bidResponse`);if(e&&"string"==typeof e&&eN(e))return e;if(e&&this.auctionIdMap.has(e))return this.auctionIdMap.get(e);let t=eA();return this.auctionIdMap.set(e,t),this.logger.debug("Generated new auctionId for invalid auctionId",{originalId:e,generatedId:t}),t}catch(t){if(this.logger.error("PubxAnalytics getAuctionId error:",t),this.logger.remotePageError({code:q.PUBX_ANALYTICS_ERROR,payload:{name:t.name,message:t.message}}),!e)return eA();return e}}track(e,t){try{switch(e){case Q.BID_TIMEOUT:t.map(this.extractBid.bind(this)).forEach(e=>{e.bidType=3,this.addBidToCache(e)});break;case Q.BID_RESPONSE:let o=Object.assign(this.extractBid(t),{bidType:2});this.addBidToCache(o);break;case Q.BID_REJECTED:let i=Object.assign(this.extractBid(t),{bidType:1});this.addBidToCache(i);break;case Q.AUCTION_END:this.processAuctionEnd(t);break;case Q.BID_WON:this.processBidWon(t)}}catch(e){this.logger.error("PubxAnalytics track error:",e),this.logger.remotePageError({code:q.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}})}}getConsentMetadata(){var e,t;try{return(null===(t=(e=this.prebidInstance).getConsentMetadata)||void 0===t?void 0:t.call(e))||{}}catch(e){return this.logger.error("PubxAnalytics getConsentMetadata error:",e),this.logger.remotePageError({code:q.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}}),{}}}getUserIds(){var e,t;try{return(null===(t=(e=this.prebidInstance).getUserIds)||void 0===t?void 0:t.call(e))||{}}catch(e){return this.logger.error("PubxAnalytics getUserIds error:",e),this.logger.remotePageError({code:q.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}}),{}}}addBidToCache(e){this.auctionCache[e.auctionId]||this.initializeAuctionCache(e.auctionId),this.auctionCache[e.auctionId].bids.push(e)}initializeAuctionCache(e){var t;let o=++this.auctionRankCounter;this.auctionRankMap.set(o,e),this.auctionCache[e]={bids:[],winningBids:[],auctionDetail:{auctionRank:o,auctionId:e,previousAuctionId:this.auctionRankMap.get(o-1)||null},floorDetail:{},adUnitDetails:[],pageDetail:{host:this.getWindowLocation().host,path:this.getWindowLocation().pathname,search:this.getWindowLocation().search},deviceDetail:{platform:navigator.platform,deviceType:tf(),deviceOS:tm(),browser:tb()},userDetail:{userIdTypes:Object.keys(this.getUserIds())},consentDetail:{consentTypes:Object.keys(this.getConsentMetadata())},pmacDetail:{pmac_data:[]},extraData:(null===(t=window.__pubx__)||void 0===t?void 0:t.extraData)||{},initOptions:Object.assign(Object.assign({},this.initOptions),{auctionId:e}),sendAs:[]}}collectAuctionAdunitData(e){try{let t=this.getAuctionId(e.auctionId),o=e.bidderRequests,i=e.adUnits,r=new Map;for(let e of i){let t=e.code,o=Object.entries(e.mediaTypes||{}).reduce((e,[t,o])=>("video"===t&&(null==o?void 0:o.context)?e.push(`video:${o.context}`):e.push(t),e),[]);r.set(t,{adunitCode:t,gptSlotCode:tg(t).gptSlot||null,mediaTypes:o,bidders:[],refreshRank:void 0})}for(let e of o)for(let t of e.bids){if(!t.adUnitCode){this.logger.error("PubxAnalytics collectAuctionAdunitData error: Missing adUnitCode in bidderRequest",{bidderRequest:e});continue}let o=r.get(t.adUnitCode);o&&(o.bidders.push(t.bidder),o.refreshRank=t.auctionsCount||t.bidRequestsCount||void 0),r.set(t.adUnitCode,o)}this.auctionCache[t].adUnitDetails=Array.from(r.values())}catch(e){this.logger.error("PubxAnalytics collectAuctionAdunitData error:",e),this.logger.remotePageError({code:q.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}})}}collectAndStoreAuctionFeedbackData(e,t){try{let o=this.getAuctionId(e.auctionId),i=this.logger.makeRemoteAucError(e),r=this.logger.makeRemoteAucEvent(e),a={remoteAucError:i,remoteAucEvent:r},n=[];e.adUnits.forEach(i=>{let r=O(i,e,t,a),{adUnitStatus:d,originalBidCpmValue:s,bidCurrency:l,adserverTargeting:u,floorData:_,floorProvider:c,floorSkipStatus:p,floorModelVersion:g}=r,f={auctionId:o,auctionRank:this.auctionRankCounter,adUnitCode:i.code,status:d,bidCurrency:l,bidValue:s,pubCurrency:t.currency,adserverTargeting:u,floorData:b(_),floorProvider:c,floorSkipStatus:p,floorModelVersion:g};n.push(f)}),Object.assign(this.auctionCache[o].pmacDetail,{pmac_data:n})}catch(r){this.logger.error("PubxAnalytics collectAndStoreAuctionFeedbackData error:",r),this.logger.remotePageError({code:q.PUBX_ANALYTICS_ERROR,payload:{name:r.name,message:r.message}});let o=this.getAuctionId(e.auctionId),i=e.adUnits.map(e=>({auctionId:o,auctionRank:this.auctionRankCounter,adUnitCode:e.code,pubCurrency:t.currency}));Object.assign(this.auctionCache[o].pmacDetail,{pmac_data:i})}}processAuctionEnd(e){var t,o;try{let i=this.getAuctionId(e.auctionId);this.auctionCache[i]||this.initializeAuctionCache(i),Object.assign(this.auctionCache[i].floorDetail,(null===(t=e.adUnits)||void 0===t?void 0:t.map(e=>{var t,o;return(null===(t=null==e?void 0:e.bids)||void 0===t?void 0:t.length)&&(null===(o=e.bids[0])||void 0===o?void 0:o.floorData)}).find(e=>e))||{}),this.auctionCache[i].deviceDetail.cdep=e.bidderRequests.map(e=>{var t,o,i;return null===(i=null===(o=null===(t=e.ortb2)||void 0===t?void 0:t.device)||void 0===o?void 0:o.ext)||void 0===i?void 0:i.cdep}).find(e=>e),Object.assign(this.auctionCache[i].auctionDetail,{adUnitCodes:(null===(o=e.adUnits)||void 0===o?void 0:o.map(e=>e.code))||[],timestamp:e.timestamp}),this.collectAndStoreAuctionFeedbackData(e,this.config),this.collectAuctionAdunitData(e),this.prepareAuctionSend(i)}catch(e){this.logger.error("PubxAnalytics processAuctionEnd error:",e),this.logger.remotePageError({code:q.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}})}}processBidWon(e){try{let t=this.extractBid(e);this.auctionCache[t.auctionId]||this.initializeAuctionCache(t.auctionId);let o=this.auctionCache[t.auctionId].floorDetail;Object.assign(t,{floorProvider:(null==o?void 0:o.floorProvider)||null,floorFetchStatus:(null==o?void 0:o.fetchStatus)||null,floorLocation:(null==o?void 0:o.location)||null,floorModelVersion:(null==o?void 0:o.modelVersion)||null,floorSkipRate:(null==o?void 0:o.skipRate)||0,isFloorSkipped:(null==o?void 0:o.skipped)||!1,isWinningBid:!0,renderedSize:e.size,bidType:4,adServerData:this.getAdServerDataForBid(t)}),this.auctionCache[t.auctionId].winningBids.push(t),this.prepareSendWinningBids(t)}catch(e){this.logger.error("PubxAnalytics processBidWon error:",e),this.logger.remotePageError({code:q.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}})}}shouldFireEventRequest(e=""){var t;try{let o=null!==(t=this.initOptions.samplingRate)&&void 0!==t?t:1;return parseInt(function(e,t=0){let o=function(e,t){if("function"==typeof Math.imul)return Math.imul(e,t);var o=(4194303&e)*(t|=0);return 4290772992&e&&(o+=(4290772992&e)*t|0),0|o},i=3735928559^t,r=1103547991^t;for(let t=0,a;t<e.length;t++)i=o(i^(a=e.charCodeAt(t)),2654435761),r=o(r^a,1597334677);return i=o(i^i>>>16,2246822507)^o(r^r>>>13,3266489909),(4294967296*(2097151&(r=o(r^r>>>16,2246822507)^o(i^i>>>13,3266489909)))+(i>>>0)).toString()}(e))%o==0}catch(e){return this.logger.error("PubxAnalytics shouldFireEventRequest error:",e),this.logger.remotePageError({code:q.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}}),!1}}prepareSendWinningBids(e){try{let{auctionId:t}=e;if(!this.shouldFireEventRequest(t))return;let o=Object.assign({},this.auctionCache[t]);o.winningBid=e;let i={path:tR.winningBidPath,requiredKeys:["winningBid","pageDetail","deviceDetail","floorDetail","auctionDetail","userDetail","consentDetail","pmacDetail","extraData","initOptions"],eventType:"win"};this.sendData(i,o)}catch(e){this.logger.error("PubxAnalytics prepareSendWinningBids error:",e),this.logger.remotePageError({code:q.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}})}}prepareAuctionSend(e){try{if(!this.shouldFireEventRequest(e))return;let t=Object.assign({},this.auctionCache[e]),o={path:tR.auctionPath,requiredKeys:["bids","pageDetail","deviceDetail","floorDetail","auctionDetail","userDetail","adUnitDetails","consentDetail","pmacDetail","extraData","initOptions"],eventType:"auction"};if(this.auctionCache[e].sendAs.includes(o.eventType))return;this.sendData(o,t),this.auctionCache[e].sendAs.push(o.eventType)}catch(e){this.logger.error("PubxAnalytics prepareAuctionSend error:",e),this.logger.remotePageError({code:q.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}})}}sendData(e,t){try{var o,i;if(!e.requiredKeys.every(e=>!!t[e]))return;let r=((o={protocol:"https",hostname:this.initOptions.hostName||tR.defaultHost,pathname:e.path,search:{auctionTimestamp:t.auctionDetail.timestamp,pubxaiAnalyticsVersion:"v2.3.0",prebidVersion:this.prebidInstance.version.split("v")[1],pubxId:this.initOptions.pubxId}}).protocol||"http")+"://"+(o.host||o.hostname+(o.port?`:${o.port}`:""))+(o.pathname||"")+(o.search?`?${i=o.search||{},Object.keys(i).map(e=>Array.isArray(i[e])?i[e].map(t=>`${e}[]=${t}`).join("&"):`${e}=${i[e]}`).join("&")}`:"")+(o.hash?`#${o.hash}`:""),a=Object.fromEntries(e.requiredKeys.map(e=>[e,t[e]])),n=JSON.stringify([a]);fetch(r,{method:"POST",body:n,headers:{"Content-Type":"text/plain"}})}catch(e){this.logger.error("PubxAnalytics sendData error:",e),this.logger.remotePageError({code:q.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}})}}setupPrebidListeners(){this.prebidInstance.onEvent("auctionEnd",e=>{this.track(Q.AUCTION_END,e)}),this.prebidInstance.onEvent("bidResponse",e=>{this.track(Q.BID_RESPONSE,e)}),this.prebidInstance.onEvent("bidRejected",e=>{this.track(Q.BID_REJECTED,e)}),this.prebidInstance.onEvent("bidTimeout",e=>{this.track(Q.BID_TIMEOUT,e)}),this.prebidInstance.onEvent("bidWon",e=>{this.track(Q.BID_WON,e)})}logMissedEvents(){let e=this.prebidInstance.getEvents().filter(e=>tO.includes(e.eventType));e.forEach(e=>{this.track(e.eventType,e.args)})}initialise(){this.logMissedEvents(),this.setupPrebidListeners()}}tR.defaultHost="api.pbxai.com",tR.auctionPath="/analytics/auction",tR.winningBidPath="/analytics/bidwon",o().pbNsKeys.split(",").map(e=>P(e)).forEach(e=>{e0(e,"PB_GAM_GLOBAL_KVS"),function(e,t=!1){e.pbNamespace.que.push(()=>{var o;let i=null===(o=window.__pubx__)||void 0===o?void 0:o.logger;try{let o=e.pbNamespace,r=e.pbNamespace.version.replace("v","");if(t){null==i||i.debug("Prebid Analytics is enabled for Prebid version: ",r),a(e);return}null==i||i.debug("Pubx Analytics is enabled for Prebid version: ",r);let n={pubxId:e.pubxId,samplingRate:e.samplingRate},d=new tR(n,o,e);d.initialise()}catch(e){null==i||i.error("Error enabling analytics: ",e)}})}(e),s(e,td),U(e),M(e,tr),k(e)})})();